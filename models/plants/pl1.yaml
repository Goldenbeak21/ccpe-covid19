inputs:
  R0: REAL
outputs:
  S: REAL
  E: REAL
  P: REAL
  Iu: REAL
  Ic: REAL
  Ru: REAL
  Rc: REAL
  D: REAL
  cases: REAL
  C_dot: REAL
parameters:
  population:
    type: REAL
    default: 4822233
  initial_cases:
    type: REAL
    default: 100
  eps:
    type: REAL
    default: 0.15
  alpha:
    type: REAL
    default: 0.25
  delta:
    type: REAL
    default: 1
  gamma:
    type: REAL
    default: 0.1
  c:
    type: REAL
    default: 0.1
  CFR0:
    type: REAL
    default: 0.01
  CFR1:
    type: REAL
    default: 0.02
  n_ICU:
    type: REAL
    default: 300
  p_ICU:
    type: REAL
    default: 0.0125
locations:
  SEIR:
    flow:
      S: -beta * S * (eps * P + Iu + Ic) / population
      E: beta * S * (eps * P + Iu + Ic) / population - alpha * E
      P: alpha * E - delta * P
      Iu: delta * P - (gamma + c) * Iu
      Ic: c * Iu - gamma * Ic
      Ru: gamma * (1 - CFR) * Iu
      Rc: gamma * (1 - CFR) * Ic
      D: gamma * CFR * (Iu + Ic)
      cases: c * Iu
    update:
      beta: R0 / (eps / delta + 1 / gamma)
      C_dot: cases * Iu
      CFR: calc_CFR((Iu + Ic) * p_ICU)
functions:
  calc_CFR:
    inputs:
      ICU_patients: REAL
    logic: |
      if(ICU_patients > n_ICU) {
        return CFR1 - (CFR1 - CFR0) * n_ICU / ICU_patients
      }
      return CFR0
initialisation:
  state: SEIR
  valuations:
    S: population - initial_cases
    E: initial_cases
    CFR: calc_CFR(0)
